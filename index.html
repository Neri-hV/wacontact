<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filtrador de Contactos WhatsApp ‚Üí VCF</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2196F3 0%, #1565C0 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2196F3 0%, #1565C0 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }
        .header-logo {
            max-width: 200px;
            height: auto;
            background: #FFFFFF;
            padding: 15px 25px;
            border-radius: 12px;
        }
        .header h1 {
            font-size: 28px;
            margin: 0;
        }
        .header p {
            opacity: 0.95;
            font-size: 15px;
            margin: 0;
        }
        .content {
            padding: 30px;
        }
        .section {
            margin-bottom: 30px;
        }
        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .section-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(135deg, #2196F3 0%, #1565C0 100%);
            border-radius: 2px;
        }
        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            resize: vertical;
            transition: border-color 0.3s;
        }
        textarea:focus {
            outline: none;
            border-color: #2196F3;
        }
        .buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        button {
            flex: 1;
            min-width: 150px;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .btn-process {
            background: linear-gradient(135deg, #2196F3 0%, #1565C0 100%);
            color: white;
        }
        .btn-process:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(33, 150, 243, 0.4);
        }
        .btn-download {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-download:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }
        .btn-download:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        .btn-clear {
            background: #f5f5f5;
            color: #666;
        }
        .btn-clear:hover {
            background: #e0e0e0;
        }
        .stats {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .stat-card {
            flex: 1;
            min-width: 150px;
            background: linear-gradient(135deg, #2196F3 0%, #1565C0 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }
        .stat-number {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }
        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 14px;
            display: none;
        }
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .country-stats {
            margin-top: 20px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 12px;
        }
        .country-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        .country-item:last-child {
            border-bottom: none;
        }
        .country-name {
            font-weight: 500;
            color: #333;
        }
        .country-count {
            color: #2196F3;
            font-weight: 600;
        }
        .preview-box {
            background: #f9f9f9;
            border: 2px dashed #2196F3;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        .preview-title {
            font-weight: 600;
            color: #1565C0;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .preview-content {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #666;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 500 200'%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Arial, sans-serif' font-size='80' font-weight='bold'%3E%3Ctspan fill='%23000000'%3Ea%3C/tspan%3E%3Ctspan fill='%232196F3'%3ETIP%3C/tspan%3E%3Ctspan fill='%23000000'%3Eic%3C/tspan%3E%3Ctspan fill='%23FDD835'%3EAI%3C/tspan%3E%3C/text%3E%3C/svg%3E" alt="aTIPicAI" class="header-logo">
            <h1>üì± WhatsApp Contactos ‚Üí VCF</h1>
            <p>Filtra admins y descarga archivo .vcf listo para importar</p>
        </div>
        
        <div class="content">
            <div class="section">
                <div class="section-title">üìã Paso 1: Pega el HTML del Inspector</div>
                <textarea id="htmlInput" rows="8" placeholder="Pega aqu√≠ todo el HTML copiado del inspector de WhatsApp Web..."></textarea>
            </div>

            <div class="section">
                <div class="section-title">üëë Paso 2: N√∫meros a Excluir (Ej: +54 9 11 3106-7592, +595 981 550003)</div>
                <textarea id="adminsInput" rows="3" placeholder="Escribe los n√∫meros que quieres excluir, separados por comas. Pueden estar con o sin espacios/guiones"></textarea>
            </div>

            <div class="buttons">
                <button class="btn-process" onclick="processContacts()">‚ú® Procesar Contactos</button>
                <button class="btn-download" onclick="downloadVCF()" id="downloadBtn" disabled>üì• Descargar VCF</button>
                <button class="btn-clear" onclick="clearAll()">üóëÔ∏è Limpiar Todo</button>
            </div>

            <div class="alert alert-info" id="alertInfo"></div>
            <div class="alert alert-success" id="alertSuccess"></div>

            <div class="stats" id="statsContainer" style="display: none;">
                <div class="stat-card">
                    <div class="stat-number" id="totalContacts">0</div>
                    <div class="stat-label">Total Original</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="adminsRemoved">0</div>
                    <div class="stat-label">Admins Removidos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="finalContacts">0</div>
                    <div class="stat-label">Contactos Finales</div>
                </div>
            </div>

            <div class="country-stats" id="countryStats" style="display: none;">
                <div class="section-title">üåç Distribuci√≥n por Pa√≠s</div>
                <div id="countryList"></div>
            </div>

            <div class="preview-box" id="previewBox" style="display: none;">
                <div class="preview-title">üëÅÔ∏è Vista Previa del VCF (primeros 10 contactos):</div>
                <div class="preview-content" id="previewContent"></div>
            </div>
        </div>
    </div>

    <script>
        let vcfContent = '';

        const countryCodes = {
            '591': 'Bolivia',
            '51': 'Per√∫',
            '595': 'Paraguay',
            '54': 'Argentina',
            '598': 'Uruguay',
            '55': 'Brasil',
            '57': 'Colombia',
            '56': 'Chile',
            '34': 'Espa√±a',
            '39': 'Italia'
        };

        function extractPhoneNumbers(html) {
            const phoneRegex = /\+\d{1,4}[\s\d\-]+\d/g;
            const matches = html.match(phoneRegex);
            
            if (!matches) return [];
            
            const uniquePhones = [...new Set(matches)];
            return uniquePhones.map(phone => phone.trim());
        }

        function normalizePhone(phone) {
            return phone.replace(/[\s\-]/g, '');
        }

        function getCountryCode(phone) {
            const normalized = normalizePhone(phone);
            for (let code in countryCodes) {
                if (normalized.startsWith('+' + code)) {
                    return code;
                }
            }
            return 'Otro';
        }

        function generateVCF(phones) {
            let vcf = '';
            phones.forEach((phone, index) => {
                const normalized = normalizePhone(phone);
                
                vcf += 'BEGIN:VCARD\n';
                vcf += 'VERSION:3.0\n';
                vcf += `TEL;TYPE=CELL:${normalized}\n`;
                vcf += 'END:VCARD\n';
            });
            return vcf;
        }

        function processContacts() {
            const htmlInput = document.getElementById('htmlInput').value;
            const adminsInput = document.getElementById('adminsInput').value.trim();
            
            if (!htmlInput) {
                showAlert('alertInfo', '‚ö†Ô∏è Por favor, pega el HTML del inspector primero');
                return;
            }

            const allPhones = extractPhoneNumbers(htmlInput);
            
            if (allPhones.length === 0) {
                showAlert('alertInfo', '‚ö†Ô∏è No se encontraron n√∫meros de tel√©fono en el texto ingresado');
                return;
            }

            const adminsToExclude = adminsInput
                .split(',')
                .map(phone => normalizePhone(phone.trim()))
                .filter(phone => phone.length > 0);

            const filteredPhones = allPhones.filter(phone => {
                const normalized = normalizePhone(phone);
                return !adminsToExclude.includes(normalized);
            });

            const adminsRemoved = allPhones.length - filteredPhones.length;

            document.getElementById('totalContacts').textContent = allPhones.length;
            document.getElementById('adminsRemoved').textContent = adminsRemoved;
            document.getElementById('finalContacts').textContent = filteredPhones.length;
            document.getElementById('statsContainer').style.display = 'flex';

            const countryDistribution = {};
            filteredPhones.forEach(phone => {
                const code = getCountryCode(phone);
                const country = countryCodes[code] || 'Otros';
                countryDistribution[country] = (countryDistribution[country] || 0) + 1;
            });

            const sortedCountries = Object.entries(countryDistribution)
                .sort((a, b) => b[1] - a[1]);

            let countryHTML = '';
            sortedCountries.forEach(([country, count]) => {
                countryHTML += `
                    <div class="country-item">
                        <span class="country-name">${country}</span>
                        <span class="country-count">${count}</span>
                    </div>
                `;
            });

            document.getElementById('countryList').innerHTML = countryHTML;
            document.getElementById('countryStats').style.display = 'block';

            vcfContent = generateVCF(filteredPhones);

            const previewPhones = filteredPhones.slice(0, 10);
            const previewVCF = generateVCF(previewPhones);
            document.getElementById('previewContent').textContent = previewVCF;
            document.getElementById('previewBox').style.display = 'block';

            document.getElementById('downloadBtn').disabled = false;

            showAlert('alertSuccess', `‚úÖ ¬°Listo! ${filteredPhones.length} contactos procesados (${adminsRemoved} n√∫meros excluidos). Haz clic en "Descargar VCF" para obtener el archivo.`);
        }

        function downloadVCF() {
            if (!vcfContent) {
                showAlert('alertInfo', '‚ö†Ô∏è Primero debes procesar los contactos');
                return;
            }

            const blob = new Blob([vcfContent], { type: 'text/vcard;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'contactos_whatsapp.vcf';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);

            const btn = document.getElementById('downloadBtn');
            const originalText = btn.textContent;
            btn.textContent = '‚úì ¬°Descargado!';
            setTimeout(() => {
                btn.textContent = originalText;
            }, 2000);
        }

        function clearAll() {
            document.getElementById('htmlInput').value = '';
            document.getElementById('adminsInput').value = '';
            document.getElementById('statsContainer').style.display = 'none';
            document.getElementById('countryStats').style.display = 'none';
            document.getElementById('previewBox').style.display = 'none';
            document.getElementById('downloadBtn').disabled = true;
            vcfContent = '';
            hideAlerts();
        }

        function showAlert(id, message) {
            hideAlerts();
            const alert = document.getElementById(id);
            alert.textContent = message;
            alert.style.display = 'block';
        }

        function hideAlerts() {
            document.getElementById('alertInfo').style.display = 'none';
            document.getElementById('alertSuccess').style.display = 'none';
        }
    </script>
</body>
</html>